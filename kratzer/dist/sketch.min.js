/**
 * Kratzer.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/kratzer
 *
 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(e,t){"use strict";const{Numeric:{lerp:a,square:n},ArrayList:o,HSV:r,Random:s,Easing:i,Angle:{QUARTER_PI:c},Timer:l,Timer:{Set:h}}=t,{onSetup:p,onInstantiate:u,drawTextureRowByRow:d,translateRotate:g,undoTranslateRotate:w,AlphaColor:m}=e;let x,f,C;u.push(e=>{x=e}),p.push(()=>{f=e.canvas,C=x.drawingContext});const R=(e,t,o,r,i)=>{const c=400*Math.cos(o),h=400*Math.sin(o),p=e-c,u=t-h,d=e+c,g=t+h,w={x:p,y:u,length:0,angle:o,alpha:0},{easeAppear:m,easeDisappear:x}=r,f=s.Curved.between(n,50,400),C=l.create({duration:i}),R=l.create({duration:60,onProgress:n=>{const{ratio:o}=n,r=m(n.ratio);w.x=a(p,e,r),w.y=a(u,t,r),w.length=f*r,w.alpha=255*o}}),y=l.create({duration:60}),b=l.create({duration:60,onProgress:n=>{const{ratio:o}=n,r=x(n.ratio);w.x=a(e,d,r),w.y=a(t,g,r),w.length=f*(1-r),w.alpha=255*(1-o)}}),k=l.chain([C,R,y,b]);return{unit:w,timer:k}};let y;e.onSetup.push(()=>y=m.create(32,256));const b=e=>{const{x:t,y:a,length:n,angle:o,alpha:r}=e;if(r<1)return;g(t,a,o);const s=n/2;x.stroke(m.get(y,r)),x.line(-s,0,s,0),w()};let k;const z=h.create(64);let S=[];const M={easeAppear:i.Out.expo,easeDisappear:i.In.expo},v=()=>{S=[],h.clear(z);const{width:e,height:t}=f.logicalSize,a=Math.max(e,t)/Math.min(e,t),n=Math.round(20*a);for(let a=0;a<n;a+=1){const n=R(e*s.between(.25,.75),t*s.between(.25,.75),s.bool(.5)?c:-c,M,a);S.push(n.unit),h.add(z,n.timer)}},A=()=>{k=(()=>{x.background(255);const t=f.logicalSize.height;return d((e,a)=>{const n=Math.pow(a/t,3);e(a,255*(1-.1*n),255*(1-.1*n),255*(1-.08*n),255)},x),e.storePixels()})(),v()},T=()=>{for(const e of S)b(e)},I={draw:()=>{0===z.runningComponents.size&&v(),h.step(z),k(),f.drawScaled(T)},keyTyped:()=>{switch(x.key){case"p":e.pauseOrResume();break;case"g":x.save("image.png");break;case"r":A()}return!1}};e.startSketch({htmlElement:"Kratzer",logicalCanvasHeight:800,initialize:()=>{A(),x.strokeWeight(3);const{scaleFactor:e}=f;C.shadowOffsetX=4*e,C.shadowOffsetY=16*e,C.shadowBlur=12*e,C.shadowColor="rgba(0, 0, 0, 0.4)"},windowResized:()=>f.resizeIfNeeded(),onCanvasResized:A,p5Methods:I})}(p5ex,CreativeCodingCore);