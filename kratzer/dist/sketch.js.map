{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/line.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as CCC from \"@fal-works/creative-coding-core\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const {\n  Numeric: { lerp, square },\n  ArrayList,\n  HSV,\n  Random,\n  Easing,\n  Angle: { QUARTER_PI },\n  Timer,\n  Timer: { Set: TimerSet },\n} = CCC;\n\nexport const {\n  onSetup,\n  onInstantiate,\n  drawTextureRowByRow,\n  translateRotate,\n  undoTranslateRotate,\n  AlphaColor,\n} = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\n/**\n * Alias for `p.drawingContext`.\n */\nexport let context: CanvasRenderingContext2D;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n  context = (p as any).drawingContext; // eslint-disable-line\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"Kratzer\";\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 800;\n","/**\n * Line.\n */\n\nimport {\n  p,\n  translateRotate,\n  undoTranslateRotate,\n  Timer,\n  lerp,\n  square,\n  AlphaColor,\n  Random,\n} from \"./common\";\nimport * as p5ex from \"@fal-works/p5-extension\";\nimport { onSetup } from \"@fal-works/p5-extension\";\n\nexport interface Unit {\n  x: number;\n  y: number;\n  length: number;\n  angle: number;\n  alpha: number;\n}\n\nexport const create = (\n  x: number,\n  y: number,\n  angle: number,\n  easing: {\n    easeAppear: (ratio: number) => number;\n    easeDisappear: (ratio: number) => number;\n  },\n  delayDuration: number\n) => {\n  const displacementX = 400 * Math.cos(angle);\n  const displacementY = 400 * Math.sin(angle);\n  const startX = x - displacementX;\n  const startY = y - displacementY;\n  const endX = x + displacementX;\n  const endY = y + displacementY;\n\n  const unit: Unit = {\n    x: startX,\n    y: startY,\n    length: 0,\n    angle,\n    alpha: 0,\n  };\n\n  const { easeAppear, easeDisappear } = easing;\n  const length = Random.Curved.between(square, 50, 400);\n\n  const delay = Timer.create({ duration: delayDuration });\n  const appear = Timer.create({\n    duration: 60,\n    onProgress: (progress) => {\n      const { ratio } = progress;\n      const easedRatio = easeAppear(progress.ratio);\n      unit.x = lerp(startX, x, easedRatio);\n      unit.y = lerp(startY, y, easedRatio);\n      unit.length = length * easedRatio;\n      unit.alpha = 255 * ratio;\n    },\n  });\n  const wait = Timer.create({ duration: 60 });\n  const disappear = Timer.create({\n    duration: 60,\n    onProgress: (progress) => {\n      const { ratio } = progress;\n      const easedRatio = easeDisappear(progress.ratio);\n      unit.x = lerp(x, endX, easedRatio);\n      unit.y = lerp(y, endY, easedRatio);\n      unit.length = length * (1 - easedRatio);\n      unit.alpha = 255 * (1 - ratio);\n    },\n  });\n  const timer = Timer.chain([delay, appear, wait, disappear]);\n  return { unit, timer };\n};\n\nlet alphaColor: p5ex.AlphaColor.Unit;\nonSetup.push(() => (alphaColor = AlphaColor.create(32, 256)));\n\nexport const draw = (line: Unit): void => {\n  const { x, y, length, angle, alpha } = line;\n  if (alpha < 1) return;\n\n  translateRotate(x, y, angle);\n  const halfLen = length / 2;\n  p.stroke(AlphaColor.get(alphaColor, alpha));\n  p.line(-halfLen, 0, halfLen, 0);\n  undoTranslateRotate();\n};\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport { storePixels, pauseOrResume } from \"@fal-works/p5-extension\";\nimport {\n  p,\n  canvas,\n  resetCommon,\n  context,\n  drawTextureRowByRow,\n  QUARTER_PI,\n  TimerSet,\n  Random,\n  Easing,\n} from \"./common\";\nimport * as Line from \"./line\";\n\n// ---- variables | functions ----\nlet drawBackground: () => void;\nconst timers = TimerSet.create(64);\nlet lines: Line.Unit[] = [];\nconst easing = {\n  easeAppear: Easing.Out.expo,\n  easeDisappear: Easing.In.expo,\n};\n\n// ---- reset & initialize ----\nconst createBackground = () => {\n  p.background(255);\n\n  const maxY = canvas.logicalSize.height;\n  drawTextureRowByRow((setPixelRow, y) => {\n    const blackness = Math.pow(y / maxY, 3);\n    setPixelRow(\n      y,\n      255 * (1 - 0.1 * blackness),\n      255 * (1 - 0.1 * blackness),\n      255 * (1 - 0.08 * blackness),\n      255\n    );\n  }, p);\n  return storePixels();\n};\n\nconst createLines = () => {\n  lines = [];\n  TimerSet.clear(timers);\n\n  const { width, height } = canvas.logicalSize;\n  const countFactor = Math.max(width, height) / Math.min(width, height);\n  const count = Math.round(countFactor * 20);\n\n  for (let i = 0; i < count; i += 1) {\n    const line = Line.create(\n      width * Random.between(0.25, 0.75),\n      height * Random.between(0.25, 0.75),\n      Random.bool(0.5) ? QUARTER_PI : -QUARTER_PI,\n      easing,\n      i\n    );\n    lines.push(line.unit);\n    TimerSet.add(timers, line.timer);\n  }\n};\n\nexport const reset = () => {\n  drawBackground = createBackground();\n\n  resetCommon();\n\n  createLines();\n};\n\nexport const initialize = (): void => {\n  reset();\n  p.strokeWeight(3);\n  const { scaleFactor } = canvas;\n\n  context.shadowOffsetX = scaleFactor * 4;\n  context.shadowOffsetY = scaleFactor * 16;\n  context.shadowBlur = scaleFactor * 12;\n  context.shadowColor = `rgba(0, 0, 0, 0.4)`;\n};\n\n// ---- draw ----\n\nconst updateSketch = () => {\n  if (timers.runningComponents.size === 0) createLines();\n  TimerSet.step(timers);\n};\n\nconst drawSketch = () => {\n  for (const lineUnit of lines) Line.draw(lineUnit);\n};\n\nconst draw = (): void => {\n  updateSketch();\n\n  drawBackground();\n  canvas.drawScaled(drawSketch);\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  draw,\n  keyTyped,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport { HTML_ELEMENT_ID, LOGICAL_CANVAS_HEIGHT } from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: HTML_ELEMENT_ID,\n  logicalCanvasHeight: LOGICAL_CANVAS_HEIGHT,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["p5ex.canvas","onSetup","storePixels","Line.create","Line.draw","draw","pauseOrResume","startSketch","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}