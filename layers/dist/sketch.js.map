{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/rectangle.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const { onSetup, onInstantiate } = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\n/**\n * Alias for `p.drawingContext`.\n */\nexport let context: CanvasRenderingContext2D;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n  context = (p as any).drawingContext; // eslint-disable-line\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"Layers\";\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 1080;\n","/**\n * ---- Rectangle -------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport { colorWithAlpha } from \"@fal-works/p5-extension\";\nimport { p } from \"./common\";\nimport chroma from \"chroma-js\";\n\ninterface Bounds {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport const enum RectangleType {\n  Horizontal,\n  Vertical,\n}\n\nexport interface Rectangle {\n  bounds: Bounds;\n  targetBounds: Bounds;\n  color: p5.Color;\n  alpha: number;\n  targetAlpha: number;\n  type: RectangleType;\n}\n\nconst maxAlpha = 160;\n\nexport const createRectangle = (\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  type: RectangleType\n): Rectangle => {\n  let bounds: Bounds;\n  switch (type) {\n    case RectangleType.Horizontal:\n      bounds = { x, y, width, height: 0 };\n      break;\n    case RectangleType.Vertical:\n      bounds = { x, y, width: 0, height };\n      break;\n  }\n  const c = chroma.lch(95, 120, Math.random() * 360).rgb();\n  return {\n    bounds,\n    targetBounds: { x, y, width, height },\n    color: p.color(c[0], c[1], c[2]),\n    alpha: 1,\n    targetAlpha: maxAlpha,\n    type,\n  };\n};\n\nconst easeFactor = 0.05;\n\nexport const updateRectangle = (rectangle: Rectangle): boolean => {\n  const { bounds, targetBounds, type } = rectangle;\n  bounds.x += easeFactor * (targetBounds.x - bounds.x);\n  bounds.y += easeFactor * (targetBounds.y - bounds.y);\n  bounds.width += easeFactor * (targetBounds.width - bounds.width);\n  bounds.height += easeFactor * (targetBounds.height - bounds.height);\n\n  rectangle.alpha += easeFactor * (rectangle.targetAlpha - rectangle.alpha);\n\n  if (maxAlpha - 1 < rectangle.alpha) {\n    switch (type) {\n      case RectangleType.Horizontal:\n        targetBounds.y = bounds.y + bounds.height;\n        targetBounds.height = 0;\n        break;\n      case RectangleType.Vertical:\n        targetBounds.x = bounds.x + bounds.width;\n        targetBounds.width = 0;\n        break;\n    }\n    rectangle.targetAlpha = 0;\n  }\n\n  return 1 <= rectangle.alpha;\n};\n\nexport const drawRectangle = (rectangle: Rectangle): void => {\n  const { bounds, color, alpha } = rectangle;\n  p.fill(colorWithAlpha(color, alpha));\n  p.rect(bounds.x, bounds.y, bounds.width, bounds.height);\n};\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport { pauseOrResume } from \"@fal-works/p5-extension\";\nimport { Random, Numeric } from \"@fal-works/creative-coding-core\";\nimport { p, canvas } from \"./common\";\nimport {\n  Rectangle,\n  RectangleType,\n  createRectangle,\n  updateRectangle,\n  drawRectangle,\n} from \"./rectangle\";\n\n// ---- variables & functions ----\nlet rectangles: Rectangle[] = [];\n\nconst addRectangles = (): void => {\n  const { topLeft, bottomRight } = canvas.logicalRegion;\n  const { width: canvasWidth, height: canvasHeight } = canvas.logicalSize;\n  const minWidth = 0.1 * canvasWidth;\n  const minHeight = 0.1 * canvasHeight;\n  const maxWidth = 0.7 * canvasWidth;\n  const maxHeight = 0.7 * canvasHeight;\n\n  for (let i = 0; i < 4; i += 1) {\n    const x = Random.between(topLeft.x, bottomRight.x - maxWidth);\n    const y = 0;\n    const w = Random.Curved.between(Numeric.square, minWidth, maxWidth);\n    const h = canvasHeight;\n    rectangles.push(createRectangle(x, y, w, h, RectangleType.Vertical));\n  }\n  for (let i = 0; i < 3; i += 1) {\n    const x = 0;\n    const y = Random.between(topLeft.y, bottomRight.y - maxHeight);\n    const w = canvasWidth;\n    const h = Random.Curved.between(Numeric.square, minHeight, maxHeight);\n    rectangles.push(createRectangle(x, y, w, h, RectangleType.Horizontal));\n  }\n};\n\nconst updateSketch = (): void => {\n  if (p.frameCount % 120 === 1) addRectangles();\n\n  rectangles = rectangles.filter(updateRectangle);\n};\n\nconst drawSketch = (): void => {\n  p.blendMode(p.REPLACE);\n  p.background(255);\n  p.blendMode(p.MULTIPLY);\n  rectangles.forEach(drawRectangle);\n};\n\nexport const reset = (): void => {};\n\nexport const initialize = (): void => {\n  p.noStroke();\n  reset();\n};\n\nconst draw = () => {\n  updateSketch();\n  canvas.drawScaled(drawSketch);\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  keyTyped,\n  draw,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport * as Settings from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: Settings.HTML_ELEMENT_ID,\n  logicalCanvasHeight: Settings.LOGICAL_CANVAS_HEIGHT,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["p5ex","p5ex.canvas","chroma","colorWithAlpha","Random","Numeric","pauseOrResume","startSketch","Settings.HTML_ELEMENT_ID","Settings.LOGICAL_CANVAS_HEIGHT","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}