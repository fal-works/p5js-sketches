{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/shape.ts","../src/shape-array.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as CCC from \"@fal-works/creative-coding-core\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const { Random, Timer, Easing } = CCC;\n\nexport const { onSetup, onInstantiate, Noise } = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\n/**\n * Alias for `p.drawingContext`.\n */\nexport let context: CanvasRenderingContext2D;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n  context = (p as any).drawingContext; // eslint-disable-line\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"ColorGrid\";\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 800;\n","/**\n * ---- Shape -----------------------------------------------------------------\n */\n\nimport { p, Random, Noise } from \"./common\";\nimport p5 from \"p5\";\n\nexport interface Unit {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n  color: p5.Color;\n  noiseX: () => number;\n  noiseY: () => number;\n}\n\nexport const create = (x: number, y: number, color: p5.Color): Unit => ({\n  x: x + Random.Integer.signed(10),\n  y: y + Random.Integer.signed(10),\n  w: Random.Integer.between(45, 65),\n  h: Random.Integer.between(45, 65),\n  color,\n  noiseX: Noise.withChangeRate(0.002),\n  noiseY: Noise.withChangeRate(0.002),\n});\n\nexport const update = (shape: Unit): void => {\n  shape;\n};\n\nexport const draw = (shape: Unit, scaleX: number, scaleY: number): void => {\n  const { x, y, w, h, color, noiseX, noiseY } = shape;\n\n  p.fill(color);\n  p.rect(\n    x + 50 * (noiseX() - 0.5),\n    y + 50 * (noiseY() - 0.5),\n    scaleX * w,\n    scaleY * h\n  );\n};\n","/**\n * ---- Shape Array ------------------------------------------------------------\n */\n\nimport * as Shape from \"./shape\";\n\nexport const ArrayType = {\n  Row: 0,\n  Column: 1,\n} as const;\ntype ArrayType = typeof ArrayType[keyof typeof ArrayType];\n\nexport interface Unit {\n  array: Shape.Unit[];\n  visibility: number;\n  type: ArrayType;\n}\n\nexport const create = (array: Shape.Unit[], type: ArrayType): Unit => ({\n  array: array,\n  visibility: 0.0,\n  type: type,\n});\n\nexport const update = (shapes: Unit): void => {\n  shapes;\n};\n\nexport const draw = (shapes: Unit): void => {\n  const { array, visibility, type } = shapes;\n  switch (type) {\n    case ArrayType.Row:\n      for (const shape of array) Shape.draw(shape, 1.0, visibility);\n      break;\n    case ArrayType.Column:\n      for (const shape of array) Shape.draw(shape, visibility, 1.0);\n      break;\n  }\n};\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport { storePixels, pauseOrResume } from \"@fal-works/p5-extension\";\nimport {\n  p,\n  canvas,\n  resetCommon,\n  Timer,\n  Random,\n  Easing as Ease,\n  context,\n} from \"./common\";\nimport * as Shape from \"./shape\";\nimport * as ShapeArray from \"./shape-array\";\n\n// ---- variables | functions ----\nlet drawBackground: () => void;\nconst shapeArrays: ShapeArray.Unit[] = [];\nconst timers = Timer.Set.construct(32);\n\n// ---- reset & initialize ----\nconst createBackground = () => {\n  p.blendMode(p.REPLACE);\n  p.background(0, 0, 99);\n  return storePixels();\n};\n\nconst resetShapes = () => {\n  shapeArrays.length = 0;\n\n  const { width, height } = canvas.logicalSize;\n\n  const xInterval = 96;\n  const yInterval = 96;\n  const columns = Math.floor(width / xInterval) - 1;\n  const rows = Math.floor(height / yInterval) - 1;\n\n  const forEachColumn = (callback: (x: number) => void) => {\n    for (\n      let i = 0, x = width / 2 - ((columns - 1) / 2) * xInterval;\n      i < columns;\n      i += 1, x += xInterval\n    ) {\n      callback(x);\n    }\n  };\n\n  const forEachRow = (callback: (y: number) => void) => {\n    for (\n      let k = 0, y = height / 2 - ((rows - 1) / 2) * yInterval;\n      k < rows;\n      k += 1, y += yInterval\n    ) {\n      callback(y);\n    }\n  };\n\n  const createShape = (x: number, y: number, baseHue: number) => {\n    let hue = baseHue + Random.signed(30);\n    if (hue < 0) hue += 360;\n    else if (360 < hue) hue -= 360;\n    return Shape.create(x, y, p.color(hue, 100, 30, 1.0));\n  };\n\n  const setTimer = (shapeArray: ShapeArray.Unit, onComplete: () => void) => {\n    const appear = Timer.create({\n      duration: 30,\n      onProgress: (progress) =>\n        (shapeArray.visibility = Ease.Out.quart(progress.ratio)),\n    });\n    const wait = Timer.create({ duration: Random.Integer.between(60, 420) });\n    const disappear = Timer.create({\n      duration: 30,\n      onProgress: (progress) =>\n        (shapeArray.visibility = 1.0 - Ease.Out.quart(progress.ratio)),\n      onComplete: () => {\n        onComplete();\n        setTimer(shapeArray, onComplete);\n      },\n    });\n    timers.add(Timer.chain([appear, wait, disappear]));\n  };\n\n  forEachRow((y) => {\n    const createArray = () => {\n      const array: Shape.Unit[] = [];\n      const baseHue = Random.value(360);\n      forEachColumn((x) => array.push(createShape(x, y, baseHue)));\n      return array;\n    };\n    const shapeArray = ShapeArray.create(\n      createArray(),\n      ShapeArray.ArrayType.Row\n    );\n    setTimer(shapeArray, () => {\n      shapeArray.array = createArray();\n    });\n    shapeArrays.push(shapeArray);\n  });\n\n  forEachColumn((x) => {\n    const createArray = () => {\n      const array: Shape.Unit[] = [];\n      const baseHue = Random.value(360);\n      forEachRow((y) => array.push(createShape(x, y, baseHue)));\n      return array;\n    };\n    const shapeArray = ShapeArray.create(\n      createArray(),\n      ShapeArray.ArrayType.Column\n    );\n    setTimer(shapeArray, () => {\n      shapeArray.array = createArray();\n    });\n    shapeArrays.push(shapeArray);\n  });\n};\n\nexport const reset = () => {\n  drawBackground = createBackground();\n\n  resetCommon();\n\n  resetShapes();\n\n  p.blendMode(p.DIFFERENCE);\n};\n\nexport const initialize = (): void => {\n  p.colorMode(p.HSB, 360, 100, 100, 1);\n  p.noStroke();\n  p.rectMode(p.CENTER);\n\n  reset();\n\n  context;\n  // const { scaleFactor } = canvas;\n  // context.shadowOffsetX = scaleFactor * 16;\n  // context.shadowOffsetY = scaleFactor * 16;\n  // context.shadowBlur = scaleFactor * 6;\n  // context.shadowColor = `rgba(0, 0, 0, 0.1)`;\n};\n\n// ---- draw ----\n\nconst updateSketch = () => {\n  timers.step();\n  for (const array of shapeArrays) ShapeArray.update(array);\n};\n\nconst drawSketch = () => {\n  for (const array of shapeArrays) ShapeArray.draw(array);\n};\n\nconst draw = (): void => {\n  updateSketch();\n\n  drawBackground();\n  canvas.drawScaled(drawSketch);\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  draw,\n  keyTyped,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport { HTML_ELEMENT_ID, LOGICAL_CANVAS_HEIGHT } from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: HTML_ELEMENT_ID,\n  logicalCanvasHeight: LOGICAL_CANVAS_HEIGHT,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["CCC","p5ex","p5ex.canvas","create","draw","Shape.draw","storePixels","Shape.create","Ease","ShapeArray.create","ShapeArray.ArrayType","ShapeArray.update","ShapeArray.draw","pauseOrResume","startSketch","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}