/**
 * Color Grid.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/color-grid
 *
 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(e,t){"use strict";function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}const o=r(e),n=r(t),{Random:i,Timer:s,Easing:a}=n,{onSetup:c,onInstantiate:l,Noise:u}=o;let d,g;l.push(e=>{d=e}),c.push(()=>{g=e.canvas});const h=(e,t,r)=>{const{x:o,y:n,w:i,h:s,color:a,noiseX:c,noiseY:l}=e;d.fill(a),d.rect(o+50*(c()-.5),n+50*(l()-.5),t*i,r*s)},f=0,p=1,b=(e,t)=>({array:e,visibility:0,type:t}),y=e=>{const{array:t,visibility:r,type:o}=e;switch(o){case f:for(const e of t)h(e,1,r);break;case p:for(const e of t)h(e,r,1)}};let w;const v=[],C=s.Set.construct(32),E=()=>{v.length=0;const{width:e,height:t}=g.logicalSize,r=Math.floor(e/96)-1,o=Math.floor(t/96)-1,n=t=>{for(let o=0,n=e/2-(r-1)/2*96;o<r;o+=1,n+=96)t(n)},c=e=>{for(let r=0,n=t/2-(o-1)/2*96;r<o;r+=1,n+=96)e(n)},l=(e,t,r)=>{let o=r+i.signed(30);return o<0?o+=360:360<o&&(o-=360),((e,t,r)=>({x:e+i.Integer.signed(10),y:t+i.Integer.signed(10),w:i.Integer.between(45,65),h:i.Integer.between(45,65),color:r,noiseX:u.withChangeRate(.002),noiseY:u.withChangeRate(.002)}))(e,t,d.color(o,100,30,1))},h=(e,t)=>{const r=s.create({duration:30,onProgress:t=>e.visibility=a.Out.quart(t.ratio)}),o=s.create({duration:i.Integer.between(60,420)}),n=s.create({duration:30,onProgress:t=>e.visibility=1-a.Out.quart(t.ratio),onComplete:()=>{t(),h(e,t)}});C.add(s.chain([r,o,n]))};c(e=>{const t=()=>{const t=[],r=i.value(360);return n(o=>t.push(l(o,e,r))),t},r=b(t(),f);h(r,()=>{r.array=t()}),v.push(r)}),n(e=>{const t=()=>{const t=[],r=i.value(360);return c(o=>t.push(l(e,o,r))),t},r=b(t(),p);h(r,()=>{r.array=t()}),v.push(r)})},k=()=>{d.blendMode(d.REPLACE),d.background(0,0,99),w=e.storePixels(),E(),d.blendMode(d.DIFFERENCE)},O=()=>{for(const e of v)y(e)},R={draw:()=>{(()=>{C.step();for(const e of v);})(),w(),g.drawScaled(O)},keyTyped:()=>{switch(d.key){case"p":e.pauseOrResume();break;case"g":d.save("image.png");break;case"r":k()}return!1}};e.startSketch({htmlElement:"ColorGrid",logicalCanvasHeight:800,initialize:()=>{d.colorMode(d.HSB,360,100,100,1),d.noStroke(),d.rectMode(d.CENTER),k()},windowResized:()=>g.resizeIfNeeded(),onCanvasResized:k,p5Methods:R})}(p5ex,CreativeCodingCore);