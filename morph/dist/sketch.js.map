{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/point.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as CCC from \"@fal-works/creative-coding-core\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const { Random } = CCC;\n\nexport const { onSetup, onInstantiate } = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\n/**\n * Alias for `p.drawingContext`.\n */\nexport let context: CanvasRenderingContext2D;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n  context = (p as any).drawingContext; // eslint-disable-line\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"Morph\";\n\n/** The logical width of the canvas. */\nexport const LOGICAL_CANVAS_WIDTH = 720;\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 720;\n","/**\n * ---- Point ----------------------------------------------------------------\n */\n\nimport { p } from \"./common\";\n\nconst { PI, cos, sin } = Math;\nconst timeScale = 0.01;\nlet time = 1024 * Math.random();\n\nexport const count = 1000;\n\nexport interface Unit {\n  index: number;\n  x: number;\n  y: number;\n  targetX: number;\n  targetY: number;\n}\n\nexport const tick = () => {\n  time += timeScale;\n};\n\nexport const create = (i: number, x: number, y: number): Unit => ({\n  index: i,\n  x,\n  y,\n  targetX: x,\n  targetY: y,\n});\n\nexport const draw = (point: Unit): void => {\n  const r = 10;\n  const theta = time;\n  const phi = 2 * PI * (point.index / count);\n\n  const x = r * sin(theta) * cos(phi);\n  const y = r * sin(theta) * sin(phi);\n  const z = r * cos(theta);\n\n  const size = 4 + 20 * p.noise(x, y, z);\n\n  p.circle(point.x, point.y, size);\n};\n\nexport const update = (point: Unit): void => {\n  point.x += 0.1 * (point.targetX - point.x);\n  point.y += 0.1 * (point.targetY - point.y);\n};\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport { onSetup, pauseOrResume } from \"@fal-works/p5-extension\";\nimport { p, canvas, Random } from \"./common\";\nimport * as Point from \"./point\";\n\n// ---- variables & functions ----\nconst { PI, cos, sin } = Math;\nconst points: Point.Unit[] = [];\nconst diffuse = () => {\n  const { width, height } = canvas.logicalSize;\n  const halfWidth = width / 2;\n  const halfHeight = height / 2;\n  points.forEach((point) => {\n    point.targetX = Random.between(-halfWidth, halfWidth);\n    point.targetY = Random.between(-halfHeight, halfHeight);\n  });\n};\nconst circle = () => {\n  const maxIndex = points.length;\n  const radius = 240;\n  const angleInterval = (2 * PI) / maxIndex;\n  points.forEach((point, i) => {\n    const angle = i * angleInterval;\n    point.targetX = radius * cos(angle);\n    point.targetY = radius * sin(angle);\n  });\n};\nconst fan = () => {\n  const maxIndex = points.length;\n  const radius = 120;\n  const angleInterval = (2 * PI) / maxIndex;\n  points.forEach((point, i) => {\n    const angle = i * angleInterval;\n    const factor = 1 + sin(4 * angle);\n    point.targetX = radius * cos(angle) * factor;\n    point.targetY = radius * sin(angle) * factor;\n  });\n};\n\nlet backgroundColor: p5.Color;\nlet shapeColor: p5.Color;\nonSetup.push((p) => {\n  backgroundColor = p.color(255, 12);\n  shapeColor = p.color(255, 0, 128, 16);\n});\n\n// ---- reset & initialize ----\nconst drawSketch = (): void => {\n  const { width, height } = canvas.logicalSize;\n  p.translate(width / 2, height / 2);\n\n  points.forEach(Point.draw);\n};\n\nexport const reset = (): void => {};\n\nexport const initialize = (): void => {\n  p.frameRate(30);\n\n  p.noStroke();\n\n  points.length = 0;\n  const { width, height } = canvas.logicalSize;\n  const halfWidth = width / 2;\n  const halfHeight = height / 2;\n  for (let i = 0; i < Point.count; i += 1) {\n    points.push(\n      Point.create(\n        i,\n        Random.between(-halfWidth, halfWidth),\n        Random.between(-halfHeight, halfHeight)\n      )\n    );\n  }\n\n  circle();\n  p.background(255);\n\n  reset();\n};\n\nconst draw = () => {\n  switch (p.frameCount % 180) {\n    case 0:\n      circle();\n      break;\n    case 60:\n      fan();\n      break;\n    case 120:\n      diffuse();\n      break;\n  }\n\n  Point.tick();\n  points.forEach(Point.update);\n\n  p.blendMode(p.ADD);\n  p.fill(backgroundColor);\n  p.rect(0, 0, p.width, p.height);\n\n  p.blendMode(p.BLEND);\n  p.fill(shapeColor);\n  canvas.drawScaled(drawSketch);\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  keyTyped,\n  draw,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport * as Settings from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: Settings.HTML_ELEMENT_ID,\n  logicalCanvasWidth: Settings.LOGICAL_CANVAS_WIDTH,\n  logicalCanvasHeight: Settings.LOGICAL_CANVAS_HEIGHT,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["CCC","p5ex","p5ex.canvas","PI","cos","sin","onSetup","Point.draw","Point.count","Point.create","draw","Point.tick","Point.update","pauseOrResume","startSketch","Settings.HTML_ELEMENT_ID","Settings.LOGICAL_CANVAS_WIDTH","Settings.LOGICAL_CANVAS_HEIGHT","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}