/**
 * ShapesAndRipples.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/shapes-and-ripples
 *
 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(t,e){"use strict";function o(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(o){if("default"!==o){var r=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(e,o,r.get?r:{enumerable:!0,get:function(){return t[o]}})}})),e.default=t,Object.freeze(e)}const r=o(t),a=o(e),{Coordinates2D:s}=a,{onSetup:n,onInstantiate:i,translateRotate:c,undoTranslateRotate:l,Mouse:u}=r;let d,f,h;i.push(t=>{d=t}),n.push(()=>{f=t.canvas,h=d.drawingContext});const p=(t,e)=>({x:t,y:e,rotation:0,rotationVelocity:0,temperature:0}),g=[];t.onSetup.push(t=>{const e=t.color(32,48,64),o=t.color(128,192,255);for(let r=0;r<=60;r+=1){const a=r/60;g.push(t.lerpColor(e,o,a))}});const y=t=>{t.rotationVelocity=.25,t.temperature=60},m=t=>{let{rotation:e,rotationVelocity:o}=t;e+=o;const r=.02;var a;r<=o&&(o=Math.max(.95*o,r),o==r&&Math.abs((a=e)-d.PI*Math.floor((a+d.HALF_PI)/d.PI))<r&&(e=0,o=0)),t.rotation=e,t.rotationVelocity=o,0<t.temperature&&(t.temperature-=1)},w=t=>{const{x:e,y:o,rotation:r,temperature:a}=t;c(e,o,r),d.fill(g[a]),d.rect(0,0,6,36),l()},M=(t,e,o)=>s.distanceSquared(t.x,t.y,e,o),x=(t,e,o,r)=>{const a=27+r,s=a*a;return M(t,e,o)<s},C=t=>{t.radius+=12;const e=f.logicalSize;return!(Math.max(e.width,e.height)<t.radius)};let b;const P=[];let v,O=[];const S=()=>{d.background(252),b=t.storePixels(),(()=>{P.length=0;const{width:t,height:e}=f.logicalSize,o=Math.floor(t/64)-1,r=Math.floor(e/80)-1;for(let a=0,s=t/2-(o-1)/2*64;a<o;a+=1,s+=64)for(let t=0,o=e/2-(r-1)/2*80;t<r;t+=1,o+=80)P.push(p(s,o))})(),O.length=0},k=()=>{d.fill(v);const t=.15*d.frameCount;d.ellipse(0,0,36*(1+.15*Math.cos(t)),36*(1+.15*Math.sin(t)))},z=()=>{for(const t of P)w(t);u.drawAtCursor(k)},R={draw:()=>{(()=>{for(const t of P)m(t);O=O.filter(C);for(const t of P)for(const e of O){const o=Math.sqrt(M(t,e.x,e.y)),{radius:r}=e;r-12<o&&o<r&&y(t)}})(),b(),f.drawScaled(z)},keyTyped:()=>{switch(d.key){case"p":t.pauseOrResume();break;case"g":d.save("image.png");break;case"r":S()}return!1},mousePressed:()=>{u.updatePosition();const{x:t,y:e}=u.position;O.push({x:t,y:e,radius:0})},mouseMoved:()=>{u.updatePosition();const t=(()=>{u.updatePosition();const{x:t,y:e}=u.position;for(const o of P)if(x(o,t,e,18))return o})();t&&y(t)}};t.startSketch({htmlElement:"ShapesAndRipples",logicalCanvasHeight:800,initialize:()=>{S(),d.noStroke(),d.rectMode(d.CENTER),v=d.color(0,32,64,64);const{scaleFactor:t}=f;h.shadowOffsetX=16*t,h.shadowOffsetY=16*t,h.shadowBlur=6*t,h.shadowColor="rgba(0, 0, 0, 0.1)"},windowResized:()=>f.resizeIfNeeded(),onCanvasResized:S,p5Methods:R})}(p5ex,CreativeCodingCore);